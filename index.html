<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG Online Board Game</title>
    
    <!-- üîí MEDIDAS DE SEGURAN√áA -->
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="origin-when-cross-origin">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; media-src 'self'; font-src 'self';">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="nav-title">RPG Board</h1>
            <div class="nav-menu" id="nav-menu">
                <span class="user-welcome" id="user-welcome" style="display: none;">
                    Ol√°, <span id="username-display"></span>!
                </span>
                <button class="btn btn-secondary" id="login-btn">Login</button>
                <button class="btn btn-primary" id="register-btn">Registrar</button>
                <button class="btn btn-secondary" id="logout-btn" style="display: none;">Sair</button>
            </div>
        </div>
    </nav>

    <!-- Conte√∫do Principal -->
    <main class="main-container">
        <!-- Tela de Boas-vindas -->
        <div id="welcome-screen" class="screen">
            <div class="welcome-card">
                <h1>RPG Online Board Game</h1>
                <p>Crie sua conta, personalize seu personagem e jogue RPG online com seus amigos!</p>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="showLogin()">Fazer Login</button>
                    <button class="btn btn-secondary" onclick="showRegister()">Criar Conta</button>
                </div>
            </div>
        </div>

        <!-- Tela de Login -->
        <div id="login-screen" class="screen" style="display: none;">
            <div class="auth-card">
                <h2>Fazer Login</h2>
                <form id="login-form">
                    <div class="form-group">
                        <label for="login-username">Nome de Usu√°rio</label>
                        <input type="text" id="login-username" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Senha</label>
                        <input type="password" id="login-password" required>
                    </div>
                    <div id="login-error" class="error-message" style="display: none;"></div>
                    <button type="submit" class="btn btn-primary">Entrar</button>
                </form>
                <p>N√£o tem uma conta? <a href="#" onclick="showRegister()">Cadastre-se aqui</a></p>
            </div>
        </div>

        <!-- Tela de Registro -->
        <div id="register-screen" class="screen" style="display: none;">
            <div class="auth-card">
                <h2>Criar Conta</h2>
                <form id="register-form">
                    <div class="form-group">
                        <label for="reg-username">Nome de Usu√°rio</label>
                        <input type="text" id="reg-username" required minlength="3">
                    </div>
                    <div class="form-group">
                        <label for="reg-email">Email</label>
                        <input type="email" id="reg-email" required>
                    </div>
                    <div class="form-group">
                        <label for="reg-password">Senha</label>
                        <input type="password" id="reg-password" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="reg-confirm">Confirmar Senha</label>
                        <input type="password" id="reg-confirm" required>
                    </div>
                    <div id="register-error" class="error-message" style="display: none;"></div>
                    <button type="submit" class="btn btn-primary">Criar Conta</button>
                </form>
                <p>J√° tem uma conta? <a href="#" onclick="showLogin()">Fa√ßa login aqui</a></p>
            </div>
        </div>

        <!-- Tela do Jogo Solo -->
        <div id="game-screen" class="screen" style="display: none;">
            <div class="game-header">
                <h2>üéÆ Modo Solo</h2>
                <div class="game-controls">
                    <button class="btn btn-secondary" onclick="showServersScreen()">‚Üê Voltar aos Servidores</button>
                    <button class="btn btn-primary" id="create-character-btn" onclick="showCharacterCreator()">
                        Criar Personagem
                    </button>
                    <button class="btn btn-secondary" onclick="showBackgroundUploader()">
                        Alterar Fundo do Tabuleiro
                    </button>
                </div>
            </div>

            <!-- Informa√ß√µes do Personagem -->
            <div id="character-info" class="character-card" style="display: none;">
                <h3>Seu Personagem</h3>
                <div class="character-display">
                    <img id="character-icon" src="" alt="√çcone do personagem" class="character-icon">
                    <div class="character-stats">
                        <h4 id="character-name"></h4>
                        <p>Level: <span id="character-level">1</span></p>
                        <p>HP: <span id="character-hp">100</span>/100</p>
                    </div>
                </div>
            </div>

            <!-- Tabuleiro -->
            <div class="board-container">
                <h3>Tabuleiro de Jogo</h3>
                <div id="game-board" class="game-board" onclick="moveCharacter(event)">
                    <div id="board-background" class="board-background"></div>
                    <div class="board-grid" id="board-grid"></div>
                    <div id="player-piece" class="character-piece" style="display: none;">
                        <img id="piece-icon" src="" alt="Personagem">
                    </div>
                </div>
                <p class="board-info">Clique no tabuleiro para mover seu personagem</p>
            </div>
        </div>
    </main>

    <!-- Modal de Cria√ß√£o de Personagem -->
    <div id="character-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Criar Personagem</h3>
            <form id="character-form">
                <div class="form-group">
                    <label for="character-name-input">Nome do Personagem</label>
                    <input type="text" id="character-name-input" required maxlength="30">
                </div>
                <div class="form-group">
                    <label>√çcone do Personagem (PNG/JPG)</label>
                    <div class="image-upload">
                        <input type="file" id="character-image" accept="image/*" onchange="previewCharacterImage(event)">
                        <div id="character-preview" class="image-preview" style="display: none;">
                            <img id="character-preview-img" src="" alt="Preview">
                        </div>
                        <label for="character-image" class="upload-btn">Escolher Imagem</label>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeCharacterModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Criar Personagem</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Upload de Fundo -->
    <div id="background-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Escolher Fundo do Tabuleiro</h3>
            <div class="form-group">
                <label>Imagem de Fundo (PNG/JPG)</label>
                <div class="image-upload">
                    <input type="file" id="background-image" accept="image/*" onchange="previewBackgroundImage(event)">
                    <div id="background-preview" class="image-preview" style="display: none;">
                        <img id="background-preview-img" src="" alt="Preview">
                    </div>
                    <label for="background-image" class="upload-btn">Escolher Imagem</label>
                </div>
            </div>
            <div class="modal-buttons">
                <button type="button" class="btn btn-secondary" onclick="closeBackgroundModal()">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="setBackgroundImage()">Aplicar Fundo</button>
            </div>
        </div>
    </div>

    <!-- Sistema de Servidores Multiplayer -->
    <div id="servers-screen" class="screen" style="display: none;">
        <div class="servers-container">
            <div class="servers-header">
                <h2>üè∞ RPG Online - Servidores</h2>
                <div class="main-controls">
                    <button class="btn btn-primary" onclick="openCreateServerModal()">+ Criar Servidor</button>
                    <button class="btn btn-secondary" onclick="showGameScreen()">üéÆ Modo Solo</button>
                </div>
            </div>
            
            <div class="servers-content">
                <div class="servers-owned">
                    <h3>üè∞ Servidores que Voc√™ Criou (Mestre)</h3>
                    <div id="owned-servers" class="servers-grid">
                        <div class="no-servers" id="no-owned-servers">
                            <p>Voc√™ ainda n√£o criou nenhum servidor. Crie um para ser o mestre!</p>
                        </div>
                    </div>
                </div>
                
                <div class="servers-joined">
                    <h3>‚öîÔ∏è Servidores que Voc√™ Participa (Jogador)</h3>
                    <div id="joined-servers" class="servers-grid">
                        <div class="no-servers" id="no-joined-servers">
                            <p>Voc√™ n√£o participa de nenhum servidor ainda. Pe√ßa o c√≥digo de convite para um amigo!</p>
                        </div>
                    </div>
                </div>
                
                <div class="servers-join">
                    <h3>üì® Entrar em Servidor</h3>
                    <div class="join-server-form">
                        <input type="text" id="invite-code-input" placeholder="Digite o c√≥digo de convite..." maxlength="6">
                        <button class="btn btn-primary" onclick="joinServerByCode()">Entrar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela do Servidor Individual -->
    <div id="server-room-screen" class="screen" style="display: none;">
        <div class="server-room">
            <div class="server-sidebar">
                <div class="server-info">
                    <h3 id="server-name-display">Nome do Servidor</h3>
                    <p id="server-code-display">C√≥digo: ######</p>
                    <div id="server-master-badge" style="display: none;">
                        <span class="badge master">üëë Voc√™ √© o Mestre</span>
                    </div>
                </div>
                
                <div class="server-players">
                    <h4>üë• Jogadores Online</h4>
                    <div id="players-list"></div>
                </div>
                
                <div class="server-chat">
                    <h4>üí¨ Chat</h4>
                    <div id="chat-messages"></div>
                    <div class="chat-input-container">
                        <input type="text" id="chat-input" placeholder="Digite uma mensagem..." maxlength="200">
                        <button onclick="sendChatMessage()">Enviar</button>
                    </div>
                </div>
                
                <div class="server-controls">
                    <button class="btn btn-secondary" onclick="leaveServer()">Sair do Servidor</button>
                    <button class="btn btn-danger" id="delete-server-btn" onclick="deleteServer()" style="display: none;">Excluir Servidor</button>
                </div>
            </div>
            
            <div class="server-game-area">
                <div class="server-game-header">
                    <h3>üéÆ Mesa de Jogo</h3>
                    <div class="server-game-controls" id="master-controls" style="display: none;">
                        <button class="btn btn-secondary" onclick="chooseServerBackground()">Alterar Fundo</button>
                        <button class="btn btn-secondary" onclick="resetServerBoard()">Limpar Tabuleiro</button>
                        <button class="btn btn-primary" onclick="toggleBoardInstructions()">‚ùì Ajuda</button>
                    </div>
                </div>
                <div class="server-board-container">
                    <div id="server-board" class="game-board">
                        <div class="board-instructions" id="board-instructions">
                            <strong>üéØ COMO USAR:</strong><br>
                            ‚Ä¢ <strong>Arrastar:</strong> Clique e arraste seu personagem<br>
                            ‚Ä¢ <strong>Coordenadas:</strong> A1, B2, C3... (como xadrez)<br>
                            ‚Ä¢ <strong>Mestre:</strong> Ctrl+Click para adicionar personagens<br>
                            ‚Ä¢ <strong>Chat:</strong> Movimentos aparecem automaticamente
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Criar Servidor -->
    <div id="create-server-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>üè∞ Criar Novo Servidor</h3>
            <form id="create-server-form">
                <div class="form-group">
                    <label for="server-name-input">Nome do Servidor</label>
                    <input type="text" id="server-name-input" required maxlength="50" placeholder="Ex: Aventuras na Floresta Sombria">
                </div>
                <div class="form-group">
                    <label for="server-description">Descri√ß√£o (Opcional)</label>
                    <textarea id="server-description" maxlength="200" placeholder="Descreva sua campanha..."></textarea>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeCreateServerModal()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Criar Servidor</button>
                </div>
            </form>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>